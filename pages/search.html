<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CamFlix - Search Movies</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <link rel="icon" href="../images/CamFlix-Logo.png" type="image/png">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
    <style>
        .card {
      
           
            transition: all 0.3s;
        }
        /* Remove translate hover to match index/explore hover (image scale + overlay) */
        .card:hover {
            transform: none;
        }
        
        .line-clamp-1 {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .search-result-item {
            transition: all 0.2s ease;
        }
        
        .search-result-item:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateX(5px);
        }
        
        .no-results {
            color: #9CA3AF;
            text-align: center;
            padding: 40px 20px;
        }
        
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Hide scrollbar for dropdown */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen text-gray-800 dark:text-white">

    <!-- Search Container -->
    <div class="container mx-auto px-4 pt-8">
        <div class="flex items-center gap-4 mb-6">
            <!-- Back Button -->
            <a href="../index.html" class="p-2 rounded-full bg-white dark:bg-gray-900 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-700 transition" title="Go back">
                <i class="fa-solid fa-arrow-left text-lg"></i>
            </a>
            
            <!-- Search Bar -->
            <div class="relative w-full max-w-2xl">
                <div class="flex items-center outline-2 outline-offset-2 outline-solid opacity-75 w-full outline-gray-300 dark:outline-sky-500 bg-white/10 dark:bg-white/5 backdrop-blur-md rounded-full px-6 py-3 border border-gray-300 dark:border-white/20 shadow-sm">
                    <i class="fa-solid fa-search text-gray-500 mr-3 text-lg"></i>
                    <input 
                        type="text" 
                        id="search-input"
                        placeholder="Search for movies..." 
                        class="bg-transparent border-none outline-none text-lg w-full text-gray-900 dark:text-white placeholder-gray-500 focus:ring-0"
                        autocomplete="off"
                    >
                    <button 
                        id="clear-search" 
                        class="hidden text-gray-600 hover:text-gray-400 ml-3 transition-opacity duration-200"
                        onclick="clearSearch()"
                    >
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>
            </div>
        <button id="theme-dark-light-toggle" 
                class="p-1 flex justify-center items-center rounded-full w-[40px] h-[40px] bg-gray-200 dark:bg-gray-800 text-black dark:text-white hover:bg-gray-200 dark:hover:bg-gray-700 transition shadow-sm" title="Toggle dark/light mode">

                <!-- Moon icon (show in LIGHT mode) -->
                <svg id="moon-icon" class="w-7 h-5 dark:hidden rounded" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
                </svg>

                <!-- Sun icon (show in DARK mode) -->
                <svg id="sun-icon" class="w-7 h-5 hidden dark:block rounded" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
        </button>
    </div>

    <!-- Movies Grid -->
    <div id="movies-container" class="container mx-auto px-4 py-8 dark:bg-gray-900">
        <h2 id="section-title" class="text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center md:text-left">
            <span id="title-text">Popular Search</span>
            <span id="search-count" class="text-sm font-normal text-gray-400 ml-2 hidden"></span>
        </h2>
        
        <!-- Loading Skeleton -->
        <div id="loading-skeleton" class="hidden grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            <!-- Skeleton cards will be added here -->
        </div>
        
        <!-- Movies Grid -->
        <div id="movies-grid" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            <!-- Movies will load here dynamically -->
        </div>

        <!-- Load More Button -->
        <div class="hidden flex justify-center mt-6">
            <button id="load-more-btn" class="hidden bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-full">Load more</button>
        </div>
        
        <!-- No Results Message -->
        <div id="no-results" class="no-results hidden">
            <i class="fa-solid fa-film text-5xl mb-4 opacity-50"></i>
            <h3 class="text-xl font-semibold mb-2">No movies found</h3>
            <p class="text-gray-400">Try searching for a different movie</p>
        </div>
    </div>

    <script>
        const apiKey = "4113f3ad734e747a5b463cde8c55de42";
        const imageBaseURL = "https://image.tmdb.org/t/p/w500";
        let currentPage = 1;
        let isSearching = false;
        let currentSearchTerm = '';
        let searchTimeout;
        let totalResults = 0;

        // DOM Elements
        const moviesGrid = document.getElementById("movies-grid");
        const searchInput = document.getElementById("search-input");
        const clearSearchBtn = document.getElementById("clear-search");
        const sectionTitle = document.getElementById("title-text");
        const searchCount = document.getElementById("search-count");
        const noResultsDiv = document.getElementById("no-results");
        const loadingSkeleton = document.getElementById("loading-skeleton");
        const loadMoreBtn = document.getElementById("load-more-btn");

        // Initialize with popular movies
        fetchPopularMovies();

        // Search as you type
        searchInput.addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();
            
            // Show/hide clear button
            if (query) {
                clearSearchBtn.classList.remove('hidden');
            } else {
                clearSearchBtn.classList.add('hidden');
                // If search is cleared, show popular movies
                if (isSearching) {
                    resetToPopularMovies();
                }
                return;
            }
            
            // Debounce search to avoid too many API calls
            searchTimeout = setTimeout(() => {
                currentSearchTerm = query;
                currentPage = 1;
                isSearching = true;
                
                // Clear previous results
                moviesGrid.innerHTML = '';
                noResultsDiv.classList.add('hidden');
                loadMoreBtn.classList.add('hidden');
                
                // Show loading skeleton
                showLoadingSkeleton();
                
                // Fetch search results
                fetchSearchResults(query, currentPage);
            }, 500); // 500ms delay
        });

        // Also trigger search on Enter key
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const query = e.target.value.trim();
                if (query) {
                    currentSearchTerm = query;
                    currentPage = 1;
                    isSearching = true;
                    moviesGrid.innerHTML = '';
                    noResultsDiv.classList.add('hidden');
                    showLoadingSkeleton();
                    fetchSearchResults(query, currentPage);
                }
            }
        });

        // Load more functionality
        loadMoreBtn.addEventListener('click', () => {
            currentPage++;
            if (isSearching) {
                fetchSearchResults(currentSearchTerm, currentPage);
            } else {
                fetchPopularMovies(currentPage, true);
            }
        });

        // Function to fetch popular movies
        function fetchPopularMovies(page = 1, append = false) {
            isSearching = false;
            showLoadingSkeleton();
            
            fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${apiKey}&language=en-US&page=${page}`)
                .then(res => res.json())
                .then(data => {
                    hideLoadingSkeleton();
                    sectionTitle.textContent = "Popular Search";
                    searchCount.classList.add('hidden');
                    
                    if (!append) {
                        moviesGrid.innerHTML = '';
                    }
                    
                    if (data.results.length > 0) {
                        displayMovies(data.results, append);
                        if (data.page < data.total_pages) {
                            loadMoreBtn.classList.remove('hidden');
                        } else {
                            loadMoreBtn.classList.add('hidden');
                        }
                        noResultsDiv.classList.add('hidden');
                    } else {
                        noResultsDiv.classList.remove('hidden');
                        loadMoreBtn.classList.add('hidden');
                    }
                })
                .catch(err => {
                    console.error("Error fetching movies:", err);
                    hideLoadingSkeleton();
                });
        }

        // Function to search movies
        function fetchSearchResults(query, page = 1, append = false) {
            if (!query.trim()) return;
            
            showLoadingSkeleton();
            
            fetch(`https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&language=en-US&query=${encodeURIComponent(query)}&page=${page}`)
                .then(res => res.json())
                .then(data => {
                    hideLoadingSkeleton();
                    sectionTitle.textContent = "Search Results";
                    searchCount.textContent = `(${data.total_results} found)`;
                    searchCount.classList.remove('hidden');
                    
                    totalResults = data.total_results;
                    
                    if (!append) {
                        moviesGrid.innerHTML = '';
                    }
                    
                    if (data.results.length > 0) {
                        displayMovies(data.results, append);
                        
                        if (data.page < data.total_pages) {
                            loadMoreBtn.classList.remove('hidden');
                        } else {
                            loadMoreBtn.classList.add('hidden');
                        }
                        noResultsDiv.classList.add('hidden');
                    } else {
                        noResultsDiv.classList.remove('hidden');
                        loadMoreBtn.classList.add('hidden');
                    }
                })
                .catch(err => {
                    console.error("Error searching movies:", err);
                    hideLoadingSkeleton();
                });
        }

        // Function to display movies
        function displayMovies(movies, append = false) {
            if (!append) {
                moviesGrid.innerHTML = '';
            }
            
            movies.forEach(movie => {
                const card = document.createElement("div");
                // match index/explore card classes so group-hover works
                card.classList.add("group", "card", "movie-card", "cursor-pointer", "dark:text-white", "text-black");
                card.dataset.movieId = movie.id;
                
                // Format release date
                let releaseDate = "N/A";
                if (movie.release_date) {
                    const date = new Date(movie.release_date);
                    releaseDate = date.getFullYear();
                }
                
                // Handle missing poster
                const posterUrl = movie.poster_path 
                    ? imageBaseURL + movie.poster_path
                    : 'https://via.placeholder.com/291x376?text=No+Poster';
                
                                card.innerHTML = `
                            <div class="relative aspect-2/3 rounded-xl overflow-hidden mb-3">
                                <img src="${movie.poster_path ? imageBaseURL + movie.poster_path : posterUrl}" class="w-full min-h-70 object-cover group-hover:scale-110 transition duration-300" alt="${movie.title}">
                                <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition"></div>
                            </div>
                            <div class="flex place-content-between">
                                <h3 class="font-bold text-gray-800 dark:text-[#EEF2FF] text-[20px] truncate movie-title">${movie.title}</h3>
                                <span class="text-yellow-400 flex items-center gap-1"><i class="fa-solid fa-star"></i> <span class="movie-rating">${movie.vote_average?.toFixed(1) ?? 'N/A'}</span></span>
                            </div>
                            <div class="flex items-center text-sm text-gray-500 dark:text-[#acafb5] gap-2 mt-1">
                                <span class="movie-genre">${releaseDate}</span>
                            </div>
                        `;
                // Navigate to detail page when card is clicked
                card.addEventListener('click', () => {
                    // Use pages/detail.html path to match site structure
                    window.location.href = `./detail.html?movieId=${movie.id}`;
                });

            moviesGrid.appendChild(card);
            });
        }

        // Function to clear search
        function clearSearch() {
            searchInput.value = '';
            clearSearchBtn.classList.add('hidden');
            resetToPopularMovies();
        }

        // Reset to popular movies
        function resetToPopularMovies() {
            isSearching = false;
            currentPage = 1;
            moviesGrid.innerHTML = '';
            noResultsDiv.classList.add('hidden');
            sectionTitle.textContent = "Popular Movies";
            searchCount.classList.add('hidden');
            showLoadingSkeleton();
            fetchPopularMovies(1);
        }

        // Loading skeleton functions
        function showLoadingSkeleton() {
            loadingSkeleton.classList.remove('hidden');
            moviesGrid.classList.add('hidden');
            
            // Create skeleton cards
            loadingSkeleton.innerHTML = '';
            for (let i = 0; i < 10; i++) {
                const skeletonCard = document.createElement("div");
                skeletonCard.className = "card";
                skeletonCard.innerHTML = `
                    <div class="skeleton w-full h-[376px] rounded-2xl"></div>
                    <div class="mt-3 mb-2 flex justify-between items-start px-2">
                        <div class="flex-1 min-w-0 pr-2">
                            <div class="skeleton h-6 w-3/4 rounded"></div>
                            <div class="skeleton h-4 w-1/2 rounded mt-2"></div>
                        </div>
                        <div class="skeleton w-16 h-8 rounded-lg"></div>
                    </div>
                `;
                loadingSkeleton.appendChild(skeletonCard);
            }
        }

        function hideLoadingSkeleton() {
            loadingSkeleton.classList.add('hidden');
            moviesGrid.classList.remove('hidden');
        }

        // Auto-focus search input on page load
        window.addEventListener('load', () => {
            searchInput.focus();
        });
    </script>

    <!-- Script for dark mode on mobile menu -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const toggleButton = document.getElementById("theme-dark-light-toggle");
        const html = document.documentElement;

    // Load saved theme
    if (localStorage.getItem("theme") === "dark") {
        html.classList.add("dark");
    }

    // Toggle
    toggleButton.addEventListener("click", () => {
        html.classList.toggle("dark");

        // Save theme
        localStorage.setItem("theme",
            html.classList.contains("dark") ? "dark" : "light"
            );
        });
    });
    </script>

    <!-- Scripts for mobile menu -->
    <script>
        const menuBtn = document.getElementById('menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        let isMenuOpen = false;

        function toggleMenu() {
            isMenuOpen = !isMenuOpen;
            if (isMenuOpen) {
                mobileMenu.classList.remove('menu-closed');
                mobileMenu.classList.add('menu-open');
                // Change icon to X
                menuBtn.innerHTML = '<i class="fa-solid fa-xmark text-2xl"></i>';
                document.body.style.overflow = 'hidden'; // Prevent scrolling
            } else {
                mobileMenu.classList.remove('menu-open');
                mobileMenu.classList.add('menu-closed');
                // Change icon back to bars
                menuBtn.innerHTML = '<i class="fa-solid fa-bars text-2xl"></i>';
                document.body.style.overflow = ''; // Enable scrolling
            }
        }
        menuBtn.addEventListener('click', toggleMenu);

        // Background navigation on scroll
        // Scroll Event Listener
        window.addEventListener('scroll', () => {
            const mainNav = document.getElementById('mainNav');

            if (window.scrollY > 50) {
                mainNav.classList.remove('bg-gradient-to-b', 'from-black/90', 'to-transparent');
                mainNav.classList.add('bg-black/40', 'backdrop-blur-md', 'border-b', 'border-white/10', 'shadow-lg');
            } else {
                // AT THE TOP: Reset to original
                mainNav.classList.remove('bg-black/40', 'backdrop-blur-md', 'border-b', 'border-white/10', 'shadow-lg');
                mainNav.classList.add('bg-gradient-to-b', 'from-black/90', 'to-transparent');
            }
        });
    </script>

</body>
</html>